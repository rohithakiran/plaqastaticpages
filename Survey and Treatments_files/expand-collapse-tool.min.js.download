var countMap={};var ignore_class="ignore";var EXPAND_COLLAPSE_UTILS={section_class_prefix:"workflow_group_",expand_collapse_tool_hidden_field_class:"expand-collapse-tool-field",sectionMap:{},REMOVE_ALL:"ALL",displayRowIndexMap:{},deletedRowIndexMap:{},$_isValid_field_type:function(a){let _type=a.toLowerCase();return(_type!="submit"&&_type!="cancel"&&_type!="image"&&_type!="hidden"&&_type!="readonly")},$_get_field_id:function(a){let fldName=a.attr("name");let questionId=!fldName?null:fldName.substring(fldName.indexOf("[")+1,fldName.indexOf("]"));return !questionId?null:"answer_"+questionId},$_clear_values:function(a){let validate_error_className="validate-failed";let validate_error_id="{0}_error";let me=this;if(a&&a.length>0){a.each(function(){let $_field=$(this);let _type=this.type.toLowerCase();if(me.$_isValid_field_type(_type)){if(_type==="checkbox"||_type==="radio"){$_field.prop("checked",false)}else{if(_type==="select-one"||_type==="select-multiple"){$_field.prop("selectedIndex",null)}else{$_field.val("")}}$_field.trigger("change");$_field.addClass(ignore_class);let $_field_id=me.$_get_field_id($_field);if($_field_id){let validate_error_label=$("#"+validate_error_id.replace("{0}",$_field_id));$_field.removeClass(validate_error_className);if(validate_error_label){validate_error_label.empty()}}}})}EXPAND_COLLAPSE_UTILS.$_restore_pre_value(a)},$_restore_pre_value:function(a){let me=this;if(a&&a.length>0){a.each(function(){let $_field=$(this);let _type=this.type.toLowerCase();if(me.$_isValid_field_type(_type)){let pre_value=$_field.attr("pre-v");if(pre_value&&pre_value!=undefined&&pre_value!=""){$_field.val(pre_value);$_field.trigger("change")}}})}},$_ignore_all_fields_for_all_sections:function(){let me=this;for(let key in this.sectionMap){let item=this.sectionMap[key],_secName=item.sectionName,_groupClassName=this.section_class_prefix+_secName;let _fields=$("."+_groupClassName+" :input");_fields.each(function(){let _type=this.type.toLowerCase();let $_field=$(this);if(me.$_isValid_field_type(_type)){$_field.addClass(ignore_class)}})}},$_get_questionId:function(a){let showMoreToggle=$("#"+a+"_show_more_toggle");if(showMoreToggle){return showMoreToggle.attr("data-q-id")}return null},$_append_display_index_field:function(a){var c=this,d=a+"_display_rows",b=c.displayRowIndexMap[a]||[];let $_field=$("#answer_"+d);if($_field[0]){$_field.val(b)}else{$($("form")[0]).append("<input type='hidden' id='answer_"+d+"' name='answers["+d+"]' class='"+c.expand_collapse_tool_hidden_field_class+"' data-group='"+a+"' data-type='display-rows' value='"+b+"'>")}},$_append_deleted_index_field:function(b){var c=this,d=b+"_deleted_rows",a=c.deletedRowIndexMap[b]||[];let $_field=$("#answer_"+d);if($_field[0]){$_field.val(a)}else{$($("form")[0]).append("<input type='hidden' id='answer_"+d+"' name='answers["+d+"]' class='"+c.expand_collapse_tool_hidden_field_class+"' data-group='"+b+"' data-type='deleted-rows' value='"+a+"'>")}},$_get_display_field_values:function(a){let me=this,field_id_suffix=a+"_display_rows";let $_field=$("#answer_"+field_id_suffix);let _value=$_field.val();let values=$_field[0]&&_value&&_value!=""?_value.split(","):null;if(values&&values.length>0){return values.map(function(b){return parseInt(b)})}return[]},$_get_deleted_field_values:function(a){let me=this,field_id_suffix=a+"_deleted_rows";let $_field=$("#answer_"+field_id_suffix);let _value=$_field.val();let values=$_field[0]&&_value&&_value!=""?_value.split(","):null;if(values&&values.length>0){return values.map(function(b){return parseInt(b)})}return[]},$_add_row_index:function(a,b){let me=this;if(a&&b){if(!me.displayRowIndexMap[a]){me.displayRowIndexMap[a]=[b]}else{if(me.displayRowIndexMap[a].indexOf(b)<=-1){me.displayRowIndexMap[a].push(b)}}me.$_append_display_index_field(a)}},$_remove_row_index:function(a,b){let me=this;if(a&&b){if(typeof(b)=="string"&&b.toLowerCase()=="all"){if(me.displayRowIndexMap[a]){me.displayRowIndexMap[a]=undefined}if(me.deletedRowIndexMap[a]){me.deletedRowIndexMap[a]=undefined}}else{if(typeof(b)=="number"){if(!me.displayRowIndexMap[a]){me.displayRowIndexMap[a]=me.$_get_display_field_values(a)}if(me.displayRowIndexMap[a]){me.displayRowIndexMap[a]=$.grep(me.displayRowIndexMap[a],function(c){return c!=b})}if(!me.deletedRowIndexMap[a]){me.deletedRowIndexMap[a]=me.$_get_deleted_field_values(a)}if(me.deletedRowIndexMap[a]){if(me.deletedRowIndexMap[a].indexOf(b)<=-1){me.deletedRowIndexMap[a].push(b)}}}}me.$_append_display_index_field(a);me.$_append_deleted_index_field(a)}},$_restore_all_deleted_rows:function(a){if(this.deletedRowIndexMap[a]){this.deletedRowIndexMap[a]=undefined}this.$_append_deleted_index_field(a)},$_init_collapse_expand_during_loading:function(){let me=this;me.displayRowIndexMap={};me.deletedRowIndexMap={};let $_fields=$("input[type=hidden]."+me.expand_collapse_tool_hidden_field_class);$_fields.each(function(){let $_field=$(this),groupClass=$_field.attr("data-group"),dataType=$_field.attr("data-type"),dataValue=$_field.val();if(dataType=="display-rows"&&dataValue){me.displayRowIndexMap[groupClass]=dataValue.split(",").map(function(a){return parseInt(a)})}else{if(dataType=="deleted-rows"&&dataValue){me.deletedRowIndexMap[groupClass]=dataValue.split(",").map(function(a){return parseInt(a)})}}});for(let groupClass in me.displayRowIndexMap){let items=me.displayRowIndexMap[groupClass];if(groupClass&&items){addMoreBtnHandler(groupClass,items,[])}}for(let groupClass in me.deletedRowIndexMap){let items=me.deletedRowIndexMap[groupClass];deleteGroup(groupClass,null,items);addMoreBtnHandler(groupClass,[],items)}}};function addMoreBtnHandler(d,e,c){let maxDelIndex=null;let _startIndex=1;let _index=countMap[d]||_startIndex;let groups=document.getElementsByClassName(d);let me=document.getElementById(d+"_add_more_btn");for(var b=_index;b<groups.length;b++){var f=groups[b];if(e&&e.length>=0){if(e.indexOf(b)>-1){$(f).removeClass("workflow_group_hide");_index=b;let fields=$(f).find(":input");fields.map(function(){let _field=$(this),_type=_field[0].type.toLowerCase();if(EXPAND_COLLAPSE_UTILS.$_isValid_field_type(_type)){_field.removeClass(ignore_class)}})}}else{if(f){let fields=$(f).find(":input");let flag=false;let first_que_idx=-1;for(let j=0;j<fields.length;j++){let _type=fields[j].type.toLowerCase();if(EXPAND_COLLAPSE_UTILS.$_isValid_field_type(_type)){if(first_que_idx<=-1){first_que_idx=j}let $_field=$(fields[j]);$_field.removeClass(ignore_class);flag=true}}if(first_que_idx>-1){setTimeout(function(){fields[first_que_idx].focus()},10)}$(f).removeClass("workflow_group_hide");_index=b;EXPAND_COLLAPSE_UTILS.$_add_row_index(d,_index);if(flag){break}}}}if(c&&c.length>0){maxDelIndex=c[0];for(var a=1;a<c.length;a++){if(maxDelIndex<c[a]){maxDelIndex=c[a]}}}if(!maxDelIndex){_index++;countMap[d]=_index}else{if(maxDelIndex>=_index){_index=maxDelIndex;_index++;countMap[d]=_index}}if(e){let _auto_total=e.length+(EXPAND_COLLAPSE_UTILS.deletedRowIndexMap[d]?EXPAND_COLLAPSE_UTILS.deletedRowIndexMap[d].length:0);if(!me&&_index<groups.length&&_auto_total<groups.length-1){let key=d.replace("workflow_group_","");let showMoreBtnText=EXPAND_COLLAPSE_UTILS.sectionMap[key]["showMoreBtnText"];appendShowMoreButton(d,showMoreBtnText);me=document.getElementById(d+"_add_more_btn")}}if(_index>=groups.length&&me&&me.className.indexOf("btn_hide")<=-1){$(me).addClass("btn_hide")}else{if(_index<groups.length&&me&&me.className.indexOf("btn_hide")>-1){$(me).removeClass("btn_hide")}}if(me){me.blur()}}function collapseSections(a){let _startIndex=1;countMap[a]=undefined;let showMoreBtnID=a+"_add_more_btn";let restore_container=document.getElementById(a+"_restore");let showMoreBtn=document.getElementById(showMoreBtnID);let groups=document.getElementsByClassName(a);for(let i=_startIndex;i<groups.length;i++){let group=groups[i];if(group&&group.className.indexOf("workflow_group_hide")<=-1){$(group).addClass("workflow_group_hide")}if(group&&group.className.indexOf("workflow_group_deleted")>-1){$(group).removeClass("workflow_group_deleted")}let fields=$(group).find(":input");EXPAND_COLLAPSE_UTILS.$_clear_values(fields)}if(showMoreBtn&&showMoreBtn.className.indexOf("btn_hide")<=-1){$(showMoreBtn).addClass("btn_hide")}if(restore_container.className.indexOf("btn_hide")<0){$(restore_container).addClass("btn_hide");let restoreTr=$($(restore_container).closest("tr")[0]);restoreTr.addClass("btn_hide")}EXPAND_COLLAPSE_UTILS.$_remove_row_index(a,EXPAND_COLLAPSE_UTILS.REMOVE_ALL)}function showMoreToggleHandler(a,b,c){try{let showMoreBtnID=a+"_add_more_btn";let showMoreBtn=document.getElementById(showMoreBtnID);let allowShowMore=c.checked;$(c).parent().attr("aria-checked",allowShowMore);if(!showMoreBtn){appendShowMoreButton(a,b)}if(allowShowMore){addMoreBtnHandler(a)}else{collapseSections(a)}}catch(d){console.error(d)}}function appendShowMoreButton(a,b){let showMoreBtnID=a+"_add_more_btn";let showMoreBtn=document.getElementById(showMoreBtnID);if(!showMoreBtn){let showMoreBtnHtml='<tr style="border: none"> <td align="left" valign="top"> <div tabindex="0" role="button" aria-label="'+b+'" class="addMore_Btn btn_hide" id="'+showMoreBtnID+'" onclick="addMoreBtnHandler(\''+a+"')\">"+b+"</div></td></tr>";let trs=$("."+a);let lastTr=trs[trs.length-1];$(showMoreBtnHtml).insertAfter(lastTr);$("#"+showMoreBtnID).bind("keyup",function(c){if((c.keyCode||c.which)==13){addMoreBtnHandler(a)}})}}function deleteGroup(a,e,b){let groups=document.getElementsByClassName(a);let restore_container=document.getElementById(a+"_restore");let deleted_counter=$("."+a+".workflow_group_deleted").length;if(b&&b.length>0){for(let i=1;i<groups.length;i++){const d=groups[i];if(b.indexOf(i)>-1){deleted_counter++;$(d).addClass("workflow_group_hide workflow_group_deleted");let fields=$(d).find(":input");EXPAND_COLLAPSE_UTILS.$_clear_values(fields)}}}else{if(e>0&&e<=groups.length){var c=groups[e];if(c){if(c.className.indexOf("workflow_group_hide")<=-1){deleted_counter++;$(c).addClass("hide-animate");setTimeout(function(){$(c).removeClass("hide-animate");$(c).addClass("workflow_group_hide workflow_group_deleted")},500)}let fields=$(c).find(":input");EXPAND_COLLAPSE_UTILS.$_clear_values(fields);EXPAND_COLLAPSE_UTILS.$_remove_row_index(a,e)}}}if(deleted_counter==groups.length-1){let toggle_checkbox_id=a+"_show_more_toggle";$("#"+toggle_checkbox_id).click();setTimeout(function(){collapseSections(a)},510)}else{setTimeout(function(){if(deleted_counter>0){restore_container.childNodes[3].innerText=$("."+a+".workflow_group_deleted").length;if(restore_container.className.indexOf("btn_hide")>-1){$(restore_container).removeClass("btn_hide");let restoreTr=$($(restore_container).closest("tr")[0]);restoreTr.removeClass("btn_hide")}}else{if(restore_container.className.indexOf("btn_hide")<0){$(restore_container).addClass("btn_hide");let restoreTr=$($(restore_container).closest("tr")[0]);restoreTr.addClass("btn_hide")}}},510)}}function restoreDeletedGroup(a){let restore_container=document.getElementById(a+"_restore");let groups=document.getElementsByClassName(a);for(let i=1;i<groups.length;i++){let group=groups[i];if(group.className.indexOf("workflow_group_deleted")>-1){$(group).removeClass("workflow_group_deleted workflow_group_hide");let _fields=$(group).find(":input");_fields.each(function(){let _type=this.type.toLowerCase();let $_field=$(this);if(EXPAND_COLLAPSE_UTILS.$_isValid_field_type(_type)){$_field.removeClass(ignore_class)}});EXPAND_COLLAPSE_UTILS.$_add_row_index(a,i)}}EXPAND_COLLAPSE_UTILS.$_restore_all_deleted_rows(a);if(restore_container.className.indexOf("btn_hide")<0){$(restore_container).addClass("btn_hide");let restoreTr=$($(restore_container).closest("tr")[0]);restoreTr.addClass("btn_hide")}}$().ready(function(){EXPAND_COLLAPSE_UTILS.$_ignore_all_fields_for_all_sections();EXPAND_COLLAPSE_UTILS.$_init_collapse_expand_during_loading();$(".show-more-toggle-button").bind("keyup",function(a){if((a.keyCode||a.which)===13){let _checkbox=$(this).find("input[type=checkbox]")[0],_checked=_checkbox.checked;_checkbox.checked=!_checked;$(_checkbox).trigger("change")}})});